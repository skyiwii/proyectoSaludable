{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Verde Lim√≥n</title>
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <link rel="shortcut icon" href="{% static 'images/favicon.ico' %}" type="image/x-icon">
</head>
<body>
    <!-- Header -->
    <header>
        <div class="topbar">
            <p>Distribuidora Verde Lim√≥n ‚Ä¢ Cotiza con nosotros al +56 9 1234 5678</p>
        </div>
        <nav class="navbar">
            <div class="logo">
                <img src="{% static 'images/limon.png' %}" alt="Logo Verde Lim√≥n" class="logo-img">
                <span>Distribuidora Verde Lim√≥n</span>
            </div>
            <ul id="main-nav">
                <li><a href="{% url 'distribucion' %}">Distribuci√≥n</a></li>
                <li><a href="{% url 'nosotros' %}">Sobre Nosotros</a></li>
                <li><a href="{% url 'contacto' %}">Contacto</a></li>
            </ul>
            <!-- Men√∫ Usuario -->
            <div class="user-menu">
                <span id="welcome-msg" style="display:none;">Hola, <span id="user-name"></span>!</span>
                <button id="logout-btn" onclick="logout()" style="display:none;">Cerrar Sesi√≥n</button>
                <div class="dropdown" id="auth-dropdown">
                    <button id="auth-btn">Login / Registro</button>
                    <div class="dropdown-content" id="auth-form">
                        <div id="login-section">
                            <input type="text" id="login-username" placeholder="Usuario">
                            <input type="password" id="login-password" placeholder="Contrase√±a">
                            <button onclick="login()">Iniciar Sesi√≥n</button>
                            <p class="message" id="login-msg"></p>
                            <p style="font-size:12px; margin-top:6px;">¬øNo tienes cuenta? <a href="#" onclick="showRegisterDropdown()">Reg√≠strate</a></p>
                        </div>
                        <div id="register-section" style="display:none;">
                            <input type="text" id="reg-username" placeholder="Usuario">
                            <input type="password" id="reg-password" placeholder="Contrase√±a">
                            <input type="password" id="reg-password2" placeholder="Repetir Contrase√±a">
                            <button onclick="register()">Registrar</button>
                            <p class="message" id="reg-msg"></p>
                            <p style="font-size:12px; margin-top:6px;">¬øYa tienes cuenta? <a href="#" onclick="showLoginDropdown()">Inicia Sesi√≥n</a></p>
                        </div>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <!-- Hero -->
    <section class="hero">
        <h1>Calidad y confianza</h1>
        <p>Somos l√≠deres en distribuci√≥n de productos naturales en Atacama.</p>
        <a href="{% url 'distribucion' %}" class="btn">Ver Distribuci√≥n</a>
        <div class="search-hero">
            <input type="text" placeholder="Buscar productos...">
            <button>üîç</button>
        </div>
    </section>

    <!-- Productos en tendencia -->
    <section class="trending">
        <h2>¬°Revisa ya mismo nuestros productos!</h2>
        <div class="trending-cards">
            <div class="card">
                <img src="{% static 'images/product1.png' %}" alt="Pan de Centeno Integral">
                <h3>Pan de Centeno Integral</h3>
                <a href="{% url 'productos' %}" class="btn-small">Ver producto</a>
            </div>
            <div class="card">
                <img src="{% static 'images/product2.png' %}" alt="Barra Cereal Saludable">
                <h3>Barra Cereal Saludable</h3>
                <a href="{% url 'productos' %}" class="btn-small">Ver producto</a>
            </div>
            <div class="card">
                <img src="{% static 'images/product3.png' %}" alt="Miel Natural">
                <h3>Miel Natural</h3>
                <a href="{% url 'productos' %}" class="btn-small">Ver producto</a>
            </div>
        </div>
    </section>

    <!-- Features -->
    <section class="features">
        <div class="feature">
            <h3>Distribuci√≥n</h3>
            <p>Red de centros log√≠sticos para llegar a toda la regi√≥n.</p>
            <a href="{% url 'distribucion' %}" class="btn">Ver ubicaciones</a>
        </div>

        <div class="feature">
            <h3>Sobre Nosotros</h3>
            <p>Conoce m√°s sobre nuestra historia y valores.</p>
            <a href="{% url 'nosotros' %}" class="btn">Leer m√°s</a>
        </div>
        
        <div class="feature">
            <h3>Contacto</h3>
            <p>Solicita tu cotizaci√≥n f√°cilmente.</p>
            <a href="{% url 'contacto' %}" class="btn">Ver contactos</a>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <p>&copy; 2025 Distribuidora Verde Lim√≥n | Todos los derechos reservados</p>
    </footer>

    <script>
        // Dummy users
        let USERS = {
            'admin1': {password: '1234', role: 'admin'}, // Dummy data, esto se carga localmente para simular a los usuarios
            'user1': {password: 'abcd', role: 'user'}
        };

        // Cargar usuario actual
        const CURRENT_USER = JSON.parse(localStorage.getItem('CURRENT_USER'));
        if(CURRENT_USER){
            document.getElementById('welcome-msg').style.display = 'inline';
            document.getElementById('user-name').textContent = CURRENT_USER.username;
            document.getElementById('logout-btn').style.display = 'inline';
            document.getElementById('auth-btn').style.display = 'none';
            addDashboardLink();
        }

        function login(){
            let u = document.getElementById('login-username').value;
            let p = document.getElementById('login-password').value;
            if(USERS[u] && USERS[u].password === p){
                // guardo la info en localStorage como ya lo haces
                localStorage.setItem('CURRENT_USER', JSON.stringify({username: u, role: USERS[u].role}));

                // redirijo seg√∫n el role existente en el objeto USERS
                if (USERS[u].role === 'admin') {
                    // Mandar al dashboard de admin (y el admin_dashboard acepta ?user_type=admin)
                    window.location.href = "{% url 'dashboard' %}?user_type=admin";
                    // alternativa directa: window.location.href = "{% url 'admin_dashboard' %}?user_type=admin";
                } else {
                    window.location.href = "{% url 'dashboard' %}?user_type=user";
                    // alternativa directa: window.location.href = "{% url 'user_dashboard' %}?user_type=user";
                }
            } else {
                document.getElementById('login-msg').textContent = 'Usuario o contrase√±a incorrectos';
            }
        }

        function register(){
            let u = document.getElementById('reg-username').value;
            let p = document.getElementById('reg-password').value;
            let p2 = document.getElementById('reg-password2').value;
            if(!u || !p){
                document.getElementById('reg-msg').textContent = 'Completa todos los campos.';
                return;
            }
            if(p !== p2){
                document.getElementById('reg-msg').textContent = 'Las contrase√±as no coinciden.';
                return;
            }
            if(USERS[u]){
                document.getElementById('reg-msg').textContent = 'El usuario ya existe.';
                return;
            }
            USERS[u] = {password: p, role: 'user'};
            document.getElementById('reg-msg').textContent = '¬°Usuario creado! Puede iniciar sesi√≥n.';
        }

        function logout(){
            localStorage.removeItem('CURRENT_USER');
            window.location.reload();
        }

        function addDashboardLink(){
            const nav = document.getElementById('main-nav');
            if(!document.getElementById('dashboard-link')){
                const li = document.createElement('li');
                li.id = 'dashboard-link';
                const a = document.createElement('a');

                // Leer al usuario actual desde localStorage
                const currentUser = JSON.parse(localStorage.getItem('CURRENT_USER'));

                if (currentUser && currentUser.role === 'admin') {
                    a.href = "{% url 'admin_dashboard' %}?user_type=admin";
                } else {
                    a.href = "{% url 'user_dashboard' %}?user_type=user";
                }

                a.textContent = "Dashboard";
                li.appendChild(a);
                nav.appendChild(li);
            }
        }

        function showRegisterDropdown(){
            document.getElementById('login-section').style.display = 'none';
            document.getElementById('register-section').style.display = 'block';
        }

        function showLoginDropdown(){
            document.getElementById('login-section').style.display = 'block';
            document.getElementById('register-section').style.display = 'none';
        }

        // Toggle dropdown
        document.getElementById('auth-btn').addEventListener('click', function(){
            const f = document.getElementById('auth-form');
            f.style.display = f.style.display==='block' ? 'none':'block';
        });
    </script>
</body>
</html>
